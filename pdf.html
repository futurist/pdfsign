<!DOCTYPE html>
<html dir="ltr" mozdisallowselectionprint moznomarginboxes>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="google" content="notranslate">
  <title>PDF.js viewer using built components</title>

  <style>
    body {
      background-color: #808080;
      margin: 0;
      padding: 0;
    }
    #documentPropertiesOverlay{
      position: absolute;
    }
    #passwordOverlay{
      position: absolute;
    }
    #toolbar{
      position: fixed;
      top:0;
    }
  </style>

  <link rel="stylesheet" href="build/components/pdf_viewer.css">

  <!-- for legacy browsers -->
  <script src="build/components/compatibility.js"></script>
  <script src="build/pdf.js"></script>
  <script src="build/components/pdf_viewer.js"></script>
  <script src="viewme.js"></script>
</head>

<body tabindex="1">



  <div id="viewerContainer">
    <div id="viewer" class="pdfViewer"></div>
  </div>


  <div id="toolbar">
    <div class="splitToolbarButton">
      <button class="toolbarButton pageUp" title="Previous Page" id="previous" tabindex="13" data-l10n-id="previous">
        <span data-l10n-id="previous_label">Previous</span>
      </button>
      <div class="splitToolbarButtonSeparator"></div>
      <button class="toolbarButton pageDown" title="Next Page" id="next" tabindex="14" data-l10n-id="next">
        <span data-l10n-id="next_label">Next</span>
      </button>
    </div>
    <label id="pageNumberLabel" class="toolbarLabel" for="pageNumber" data-l10n-id="page_label">Page: </label>
    <input type="number" id="pageNumber" class="toolbarField pageNumber" value="1" size="4" min="1" tabindex="15">
    <span id="numPages" class="toolbarLabel"></span>
</div>



<div id="passwordOverlay" class="container hidden">
  <div class="dialog">
    <div class="row">
      <p id="passwordText" data-l10n-id="password_label">Enter the password to open this PDF file:</p>
    </div>
    <div class="row">
      <input type="password" id="password" class="toolbarField" />
    </div>
    <div class="buttonRow">
      <button id="passwordCancel" class="overlayButton"><span data-l10n-id="password_cancel">Cancel</span></button>
      <button id="passwordSubmit" class="overlayButton"><span data-l10n-id="password_ok">OK</span></button>
    </div>
  </div>
</div>


  <div id="documentPropertiesOverlay" class="container hidden">
    <div class="dialog">
      <div class="row">
        <span data-l10n-id="document_properties_file_name">File name:</span> <p id="fileNameField">-</p>
      </div>
      <div class="row">
        <span data-l10n-id="document_properties_file_size">File size:</span> <p id="fileSizeField">-</p>
      </div>
      <div class="separator"></div>
      <div class="row">
        <span data-l10n-id="document_properties_title">Title:</span> <p id="titleField">-</p>
      </div>
      <div class="row">
        <span data-l10n-id="document_properties_author">Author:</span> <p id="authorField">-</p>
      </div>
      <div class="row">
        <span data-l10n-id="document_properties_subject">Subject:</span> <p id="subjectField">-</p>
      </div>
      <div class="row">
        <span data-l10n-id="document_properties_keywords">Keywords:</span> <p id="keywordsField">-</p>
      </div>
      <div class="row">
        <span data-l10n-id="document_properties_creation_date">Creation Date:</span> <p id="creationDateField">-</p>
      </div>
      <div class="row">
        <span data-l10n-id="document_properties_modification_date">Modification Date:</span> <p id="modificationDateField">-</p>
      </div>
      <div class="row">
        <span data-l10n-id="document_properties_creator">Creator:</span> <p id="creatorField">-</p>
      </div>
      <div class="separator"></div>
      <div class="row">
        <span data-l10n-id="document_properties_producer">PDF Producer:</span> <p id="producerField">-</p>
      </div>
      <div class="row">
        <span data-l10n-id="document_properties_version">PDF Version:</span> <p id="versionField">-</p>
      </div>
      <div class="row">
        <span data-l10n-id="document_properties_page_count">Page Count:</span> <p id="pageCountField">-</p>
      </div>
      <div class="buttonRow">
        <button id="documentPropertiesClose" class="overlayButton"><span data-l10n-id="document_properties_close">Close</span></button>
      </div>
    </div>
  </div>


  <script type="text/javascript">
  var DEFAULT_URL = 'web/compressed.tracemonkey-pldi-09.pdf';
  var DEFAULT_SCALE_DELTA = 1.1;
  var MIN_SCALE = 0.25;
  var MAX_SCALE = 10.0;
  var VIEW_HISTORY_MEMORY = 20;
  var SCALE_SELECT_CONTAINER_PADDING = 8;
  var SCALE_SELECT_PADDING = 22;
  var PAGE_NUMBER_LOADING_INDICATOR = 'visiblePageIsLoading';
  var DISABLE_AUTO_FETCH_LOADING_BAR_TIMEOUT = 5000;

  PDFJS.imageResourcesPath = 'build/generic/web/images/';
    PDFJS.workerSrc = 'build/pdf.worker.js';
    PDFJS.cMapUrl = 'build/generic/web/cmaps/';
    PDFJS.cMapPacked = true;

  var mozL10n = document.mozL10n || document.webL10n;


  var CSS_UNITS = 96.0 / 72.0;
  var DEFAULT_SCALE = 'auto';
  var UNKNOWN_SCALE = 0;
  var MAX_AUTO_SCALE = 1.25;
  var SCROLLBAR_PADDING = 40;
  var VERTICAL_PADDING = 5;

  //var pdfViewer = new PDFJS.PDFViewer({ container:con.get(0) });


var PDFViewerApplication = {


  initialBookmark: document.location.hash.substring(1),
  initialized: false,
  fellback: false,
  pdfDocument: null,
  sidebarOpen: false,
  printing: false,
  /** @type {PDFViewer} */
  pdfViewer: null,
  /** @type {PDFThumbnailViewer} */
  pdfThumbnailViewer: null,
  /** @type {PDFRenderingQueue} */
  pdfRenderingQueue: null,
  pageRotation: 0,
  updateScaleControls: true,
  isInitialViewSet: false,
  animationStartedPromise: null,
  mouseScrollTimeStamp: 0,
  mouseScrollDelta: 0,
  preferenceSidebarViewOnLoad: "NONE",
  preferencePdfBugEnabled: false,
  preferenceShowPreviousViewOnLoad: true,
  isViewerEmbedded: (window.parent !== window),
  url: '',
  pdfLinkService : null,
  pdfHistory: null,

  // called once when the document is loaded
  initialize: function pdfViewInitialize() {

    var self = this;
    var container = document.getElementById('viewerContainer');
    var viewer = document.getElementById('viewer');

    var pdfRenderingQueue = new PDFJS.PDFRenderingQueue();
    pdfRenderingQueue.onIdle = this.cleanup.bind(this);
    this.pdfRenderingQueue = pdfRenderingQueue;

    //set up LinkService and History
    this.pdfLinkService = new PDFJS.PDFLinkService()
    this.pdfHistory = new PDFJS.PDFHistory({ linkService: this.pdfLinkService });
    this.pdfLinkService.setHistory(this.pdfHistory);

    //set up pdfViewer
    this.pdfViewer = new PDFJS.PDFViewer({
      container: container,
      viewer: viewer,
      //renderingQueue: pdfRenderingQueue,
      linkService: this.pdfLinkService
    });
    pdfRenderingQueue.setViewer(this.pdfViewer);
    this.pdfLinkService.setViewer(this.pdfViewer);

    //Set init scale
    container.addEventListener('pagesinit', function () {
      //pdfViewer.currentScale = 1;
      self.pdfViewer.currentScaleValue = 'page-width';
    });



    //Init document properties
    this.pdfDocumentProperties = new PDFDocumentProperties({
      overlayName: 'documentPropertiesOverlay',
      closeButton: document.getElementById('documentPropertiesClose'),
      fields: {
        'fileName': document.getElementById('fileNameField'),
        'fileSize': document.getElementById('fileSizeField'),
        'title': document.getElementById('titleField'),
        'author': document.getElementById('authorField'),
        'subject': document.getElementById('subjectField'),
        'keywords': document.getElementById('keywordsField'),
        'creationDate': document.getElementById('creationDateField'),
        'modificationDate': document.getElementById('modificationDateField'),
        'creator': document.getElementById('creatorField'),
        'producer': document.getElementById('producerField'),
        'version': document.getElementById('versionField'),
        'pageCount': document.getElementById('pageCountField')
      }
    });


    PasswordPrompt.initialize({
      overlayName: 'passwordOverlay',
      passwordField: document.getElementById('password'),
      passwordText: document.getElementById('passwordText'),
      passwordSubmit: document.getElementById('passwordSubmit'),
      passwordCancel: document.getElementById('passwordCancel')
    });

    var initializedPromise = Promise.all([]);

    return initializedPromise.then(function () {
      PDFViewerApplication.initialized = true;
    });

  },




  zoomIn: function pdfViewZoomIn(ticks) {
    var newScale = this.pdfViewer.currentScale;
    do {
      newScale = (newScale * DEFAULT_SCALE_DELTA).toFixed(2);
      newScale = Math.ceil(newScale * 10) / 10;
      newScale = Math.min(MAX_SCALE, newScale);
    } while (--ticks > 0 && newScale < MAX_SCALE);
    this.setScale(newScale, true);
  },

  zoomOut: function pdfViewZoomOut(ticks) {
    var newScale = this.pdfViewer.currentScale;
    do {
      newScale = (newScale / DEFAULT_SCALE_DELTA).toFixed(2);
      newScale = Math.floor(newScale * 10) / 10;
      newScale = Math.max(MIN_SCALE, newScale);
    } while (--ticks > 0 && newScale > MIN_SCALE);
    this.setScale(newScale, true);
  },

  get currentScaleValue() {
    return this.pdfViewer.currentScaleValue;
  },

  get pagesCount() {
    return this.pdfDocument.numPages;
  },

  set page(val) {
    this.pdfLinkService.page = val;
  },

  get page() { // TODO remove
    return this.pdfLinkService.page;
  },





  open: function (file, scale, password, pdfDataRangeTransport, args) {

    var self = this;
    self.loading = true;
    self.downloadComplete = false;

    var passwordNeeded = function passwordNeeded(updatePassword, reason) {
      PasswordPrompt.updatePassword = updatePassword;
      PasswordPrompt.reason = reason;
      PasswordPrompt.open();
    };


    PDFJS.getDocument( file || DEFAULT_URL).then(function  (pdf) {
      self.load(pdf, scale);
      self.loading = false;
    });

  },


  load: function (pdfDocument, scale) {

    var self = this;
    scale = scale || UNKNOWN_SCALE;


    this.pdfDocument = pdfDocument;

    this.pdfDocumentProperties.setDocumentAndUrl(pdfDocument, this.url);

    var downloadedPromise = pdfDocument.getDownloadInfo().then(function() {
      self.downloadComplete = true;
    });

    var pagesCount = pdfDocument.numPages;
    document.getElementById('numPages').textContent = 'of ' + pagesCount;
    document.getElementById('pageNumber').max = pagesCount;


    var id = this.documentFingerprint = pdfDocument.fingerprint;
    var store = this.store = new ViewHistory(id);

    //set up LinkService and History
    var baseDocumentUrl = null;
    this.pdfLinkService.setDocument(pdfDocument, baseDocumentUrl);


    var pdfViewer = this.pdfViewer;
    pdfViewer.currentScale = scale;
    pdfViewer.setDocument(pdfDocument);

    var firstPagePromise = pdfViewer.firstPagePromise;
    var pagesPromise = pdfViewer.pagesPromise;
    var onePageRendered = pdfViewer.onePageRendered;


    firstPagePromise.then(function(pdfPage) {
      downloadedPromise.then(function () {
        var event = document.createEvent('CustomEvent');
        event.initCustomEvent('documentload', true, true, {});
        window.dispatchEvent(event);
      });

      if (!PDFJS.disableHistory && !self.isViewerEmbedded) {
        // The browsing history is only enabled when the viewer is standalone,
        // i.e. not when it is embedded in a web page.
        if (!self.preferenceShowPreviousViewOnLoad && window.history.state) {
          window.history.replaceState(null, '');
        }
        self.pdfHistory.initialize(self.documentFingerprint);
        self.initialDestination = self.pdfHistory.initialDestination;
        self.initialBookmark = self.pdfHistory.initialBookmark;
      }

      store.initializedPromise.then(function resolved() {
        var storedHash = null;
        if (self.preferenceShowPreviousViewOnLoad &&
            store.get('exists', false)) {
          var pageNum = store.get('page', '1');
          var zoom = self.preferenceDefaultZoomValue ||
                     store.get('zoom', self.pdfViewer.currentScale);
          var left = store.get('scrollLeft', '0');
          var top = store.get('scrollTop', '0');

          storedHash = 'page=' + pageNum + '&zoom=' + zoom + ',' +
                       left + ',' + top;
        } else if (self.preferenceDefaultZoomValue) {
          storedHash = 'page=1&zoom=' + self.preferenceDefaultZoomValue;
        }
        self.setInitialView(storedHash, scale);

        // Make all navigation keys work on document load,
        // unless the viewer is embedded in a web page.
        if (!self.isViewerEmbedded) {
          self.pdfViewer.focus();
        }
      }, function rejected(reason) {
        console.error(reason);
        self.setInitialView(null, scale);
      });
    });




  },



  setInitialView: function pdfViewSetInitialView(storedHash, scale) {
    this.isInitialViewSet = true;

    // When opening a new file (when one is already loaded in the viewer):
    // Reset 'currentPageNumber', since otherwise the page's scale will be wrong
    // if 'currentPageNumber' is larger than the number of pages in the file.
    document.getElementById('pageNumber').value =
      this.pdfViewer.currentPageNumber = 1;

    if (this.initialDestination) {
      this.pdfLinkService.navigateTo(this.initialDestination);
      this.initialDestination = null;
    } else if (this.initialBookmark) {
      this.pdfLinkService.setHash(this.initialBookmark);
      this.pdfHistory.push({ hash: this.initialBookmark }, true);
      this.initialBookmark = null;
    } else if (storedHash) {
      this.pdfLinkService.setHash(storedHash);
    } else if (scale) {
      this.setScale(scale, true);
      this.page = 1;
    }

    if (this.pdfViewer.currentScale === UNKNOWN_SCALE) {
      // Scale was not initialized: invalid bookmark or scale was not specified.
      // Setting the default one.
      this.setScale(DEFAULT_SCALE, true);
    }
  },






  cleanup: function pdfViewCleanup() {
    this.pdfViewer.cleanup();
    this.pdfDocument.cleanup();
  },





  setScale: function (value, resetAutoSettings) {
    this.updateScaleControls = !!resetAutoSettings;
    this.pdfViewer.currentScaleValue = value;
    this.updateScaleControls = true;
  },

  rotatePages: function pdfViewRotatePages(delta) {
    var pageNumber = this.page;
    this.pageRotation = (this.pageRotation + 360 + delta) % 360;
    this.pdfViewer.pagesRotation = this.pageRotation;
    this.pdfThumbnailViewer.pagesRotation = this.pageRotation;

    this.forceRendering();

    this.pdfViewer.scrollPageIntoView(pageNumber);
  },





}

window.PDFView = PDFViewerApplication;

PDFViewerApplication.initialize().then(webViewerInitialized);
function webViewerInitialized() {

  PDFViewerApplication.open(DEFAULT_URL);

}

  </script>
</body>
</html>
